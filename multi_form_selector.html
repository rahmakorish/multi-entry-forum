<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ุณุฌู ูุดูุฑุฉ ุงูุฃุทูุงู - ุดุงูู</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body dir="rtl" style="font-family: Arial; padding: 30px">

  <h2>๐ ุณุฌู ูุดูุฑุฉ ุงูุฃุทูุงู - ุดุงูู</h2>

  <label>๐ค ุฑูุน ููู Excel (ุงุฎุชูุงุฑู):</label>
  <input type="file" id="uploadExcel" accept=".xlsx, .xls"><br /><br />

  <form id="momForm">
    <label>ุงุณู ุงูุฃู:</label><br />
    <input type="text" id="name" required><br /><br />

    <label>ุงูุฑูู ุงููููู:</label><br />
    <input type="text" id="nid" required><br /><br />

    <label>ุฑูู ุงูููุจุงูู:</label><br />
    <input type="text" id="phone" required><br /><br />

    <label>ุงุณู ุงูุทูู (ุงุฎุชูุงุฑู):</label><br />
    <input type="text" id="childName"><br /><br />

    <label>ุณู ุงูุทูู (ุงุฎุชูุงุฑู):</label><br />
    <input type="text" id="childAge" min="0"><br /><br />

    <label>ุนุฏุฏ ุงูุฃุทูุงู (ุงุฎุชูุงุฑู):</label><br />
    <input type="number" id="numChildren" min="0"><br /><br />

    <label>ุงููุฏุฉ ุจูู ุขุฎุฑ ุญูู (ุงุฎุชูุงุฑู):</label><br />
    <input type="text" id="gap"><br /><br />

    <label>ุชุงุฑูุฎ ูููุงุฏ ุงูุทูู (ุงุฎุชูุงุฑู):</label><br />
    <input type="date" id="birthDate"><br /><br />

    <button type="submit">โ ุฅุถุงูุฉ</button>
  </form>

  <br />
  <button id="downloadBtn" style="display:none;">๐ฅ ุชุญููู Excel</button>
  <button id="clearBtn" style="display:none; background-color: crimson; color: white;">๐๏ธ ูุณุญ ูู ุงูุจูุงูุงุช</button>

  <h3>๐ ุงูุจูุงูุงุช ุงูุญุงููุฉ:</h3>
  <ul id="dataList"></ul>

  <script>
    let dataList = [];

    const STORAGE_KEY = "momDataExtended";
    const listElement = document.getElementById("dataList");
    const form = document.getElementById("momForm");
    const downloadBtn = document.getElementById("downloadBtn");
    const clearBtn = document.getElementById("clearBtn");

    window.onload = () => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        dataList = JSON.parse(saved);
        updateUI();
      }
    };

    document.getElementById("uploadExcel").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const sheetData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        if (sheetData.length > 0 && sheetData[0][0] === "ุงุณู ุงูุฃู") {
          sheetData.shift(); // remove headers
        }

        for (const row of sheetData) {
          if (row.length >= 3) {
            dataList.push(row);
          }
        }

        saveToStorage();
        updateUI();
      };
      reader.readAsArrayBuffer(file);
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const nid = document.getElementById("nid").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const childName = document.getElementById("childName").value.trim();
      const childAge = document.getElementById("childAge").value.trim();
      const numChildren = document.getElementById("numChildren").value.trim();
      const gap = document.getElementById("gap").value.trim();
      const birthDate = document.getElementById("birthDate").value;
      const date = new Date().toLocaleDateString("ar-EG");

      if (!name || !nid || !phone) {
        alert("ูู ูุถูู ุฃุฏุฎู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ");
        return;
      }

      const row = [
        name,
        nid,
        phone,
        childName || "",
        childAge || "",
        numChildren || "",
        gap || "",
        birthDate || "",
        date
      ];
      dataList.push(row);
      saveToStorage();
      updateUI();
      form.reset();
    });

    downloadBtn.addEventListener("click", function () {
      const headers = [
        "ุงุณู ุงูุฃู", "ุงูุฑูู ุงููููู", "ุฑูู ุงูููุจุงูู", "ุงุณู ุงูุทูู", "ุณู ุงูุทูู",
        "ุนุฏุฏ ุงูุฃุทูุงู", "ุงููุฏุฉ ุจูู ุขุฎุฑ ุญูู", "ุชุงุฑูุฎ ูููุงุฏ ุงูุทูู", "ุชุงุฑูุฎ ุงูุฅุฏุฎุงู"
      ];
      const ws_data = [headers, ...dataList];

      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "ุณุฌู ูุดูุฑุฉ");

      const wbout = XLSX.write(wb, { bookType: "xlsx", type: "array" });
      const blob = new Blob([wbout], { type: "application/octet-stream" });

      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ุณุฌู_ูุดูุฑุฉ.xlsx";
      a.click();
    });

    clearBtn.addEventListener("click", () => {
      if (confirm("ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ูุณุญ ูู ุงูุจูุงูุงุชุ")) {
        dataList = [];
        localStorage.removeItem(STORAGE_KEY);
        updateUI();
      }
    });

    function updateUI() {
      listElement.innerHTML = "";
      dataList.forEach((row) => {
        const li = document.createElement("li");
        li.textContent =
          `๐ฉโ๐ฆฑ ${row[0]} | ๐ชช ${row[1]} | ๐ฑ ${row[2]} | ๐ถ ${row[3] || "-"} | ๐ ${row[4] || "-"} | ๐จโ๐ฉโ๐งโ๐ฆ ${row[5] || "-"} | โฑ ${row[6] || "-"} | ๐ ูููุงุฏ: ${row[7] || "-"} | ุฅุฏุฎุงู: ${row[8]}`;
        listElement.appendChild(li);
      });

      downloadBtn.style.display = dataList.length ? "inline-block" : "none";
      clearBtn.style.display = dataList.length ? "inline-block" : "none";
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dataList));
    }
  </script>

</body>
</html>
